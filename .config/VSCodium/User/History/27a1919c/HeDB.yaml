---
- name: Install helm
  ansible.builtin.apt:
    pkg:
      - helm
    state: latest
    allow_change_held_packages: true
    update_cache: true

- name: Install Cilium via Helm
  kubernetes.core.helm:
    api_key: "{{ hcloud_token }}"
    atomic: true
    kubeconfig: /etc/kubernetes/admin.conf
    chart_repo_url: https://helm.cilium.io
    chart_version: "{{ cilium_version }}"
    release_name: cilium
    release_namespace: kube-system
    values_files:
      - /tmp/cilium-values.yaml
    wait: true
