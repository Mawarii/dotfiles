---
- name: Create 'wheel' group
  ansible.builtin.group:
    name: wheel
    state: present

- name: Create new non-root user
  ansible.builtin.user:
    name: "{{ ssh_user }}"
    shell: /bin/bash
    groups: sudo,wheel
    create_home: true
    append: true

- name: Enable passwordless sudo for 'wheel' group
  community.general.sudoers:
    name: passwordless-wheel
    group: wheel
    commands:
      - ALL
    state: present
    validation: required

- name: Set authorized SSH keys
  ansible.posix.authorized_key:
    user: "{{ ssh_user }}"
    state: present
    key: "{{ item }}"
  loop: {{ ssh_keys }}
