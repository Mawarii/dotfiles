kind: Kustomization
apiVersion: kustomize.config.k8s.io/v1beta1

namePrefix: drupal-

resources:
  - ../../../../base/hsi-intranet/drupal
  - ../../../../base/mixins/database
  - configmap-drupal.yaml
  - configmap-os-middleware.yaml
  - rebuild-cronjob.yaml

secretGenerator:
  - name: mariadb
    options:
      disableNameSuffixHash: true
    envs:
      - database-secret.env
  - name: http-basic
    options:
      disableNameSuffixHash: true
    envs:
      - http-basic-secret.env
  - name: search-middleware-token
    options:
      disableNameSuffixHash: true
    envs:
      - search-middleware-secret.env

patches:
  - path: deployment.patch.yaml
    target:
      kind: Deployment
      name: drupal
  - path: mariadb-patch.yaml
    target:
      kind: MariaDB
      name: mariadb
  - path: ingress-patch.yaml
    target:
      kind: Ingress
      name: drupal
  - path: pvc-private.patch.yaml
    target:
      kind: PersistentVolumeClaim
      name: private
  - path: pvc-files.patch.yaml
    target:
      kind: PersistentVolumeClaim
      name: files
