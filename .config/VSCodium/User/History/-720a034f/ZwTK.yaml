---
keycloak:
  clientSecrets:
    bpm: 6ACE369B-774E-4FF4-B06D-F2DE3E8068D3  ## <uuidgen_me> (same as in forms-flow-ai-values.yaml)
  production: true
  proxyHeaders: xforwarded
  proxy: ""
  httpRelativePath: "/auth"
  replicaCount: 1
  auth:
    adminPassword: 1oZz1Ab4684xbUDTIhL2Sa8sjtdYV4Vc
    tls:
      enabled: true
      autoGenerated: true

  service:
    sessionAffinity: ClientIP

  extraEnvVars:
    # - name: KEYCLOAK_PRODUCTION
    #   value: 'true'
    # - name: KEYCLOAK_ADMIN_USER
    #   value: admin
    - name: KC_BOOTSTRAP_ADMIN_USERNAME
      value: admin
    - name: KC_BOOTSTRAP_ADMIN_PASSWORD
      value: 1oZz1Ab4684xbUDTIhL2Sa8sjtdYV4Vc
    - name: KC_HTTP_ENABLED
      value: "true"
    - name: KC_HOSTNAME_STRICT
      value: "false"
    - name: KEYCLOAK_EXTRA_ARGS
      value: "--import-realm"
    # - name: KEYCLOAK_PROXY_ADDRESS_FORWARDING
    #   value: "true"
    - name: JAVA_OPTS
      value: >-
        -Dkeycloak.profile.feature.scripts=enabled
        -Dkeycloak.profile.feature.upload_scripts=enabled
        -Djava.net.preferIPv4Stack=true

  extraVolumes:
    - name: "forms-flow-idm-realm-config"
      configMap:
        name: "forms-flow-idm-ppmt"

  extraVolumeMounts:
    - name: "forms-flow-idm-realm-config"
      mountPath: "/opt/bitnami/keycloak/data/import"
      readOnly: true

  image:
    registry: "docker.io"
    repository: "bitnami/keycloak"
    tag: 26.0.6

  externalDatabase:
    host: forms-flow-idm-postgresql
    port: 5432
    database: formsflowidm
    username: postgres
    existingSecret: postgres.forms-flow-idm-postgresql.credentials.postgresql.acid.zalan.do
    existingSecretPasswordKey: password

  postgresql:
    enabled: false

  resources:
    limits:
      cpu: 2
      memory: 3Gi
    requests:
      cpu: 500m
      memory: 2Gi

  initContainers: {}

  containerSecurityContext:
    enabled: false
  podSecurityContext:
    enabled: false

  keycloakConfigCli:
    containerSecurityContext:
      enabled: false
    podSecurityContext:
      enabled: false

  ingress:
    enabled: true
    ingressClassName: nginx
    hostname: forms-flow-idm-ppmt.c.dev.publicplan.cloud   #<DEFINE_ME>
    pathtype: Prefix
    servicePort: http
    tls: true
    extraTls: []
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      nginx.ingress.kubernetes.io/proxy-buffer-size: 1M
      nginx.ingress.kubernetes.io/whitelist-source-range: "213.61.255.112/29, 78.138.64.211/32, 78.138.66.143/32"

postgresql-ha:
  enabled: false
  postgresql:
    enabled: false
