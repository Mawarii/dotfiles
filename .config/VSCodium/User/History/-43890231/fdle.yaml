---
- name: Initialize first controlplane
  ansible.builtin.include_tasks: "initialize-first-controlplane.yaml"

- name: Upgrade first controlplane
  # when: auto_upgrades and kube_upgrade_needed
  ansible.builtin.include_tasks: "upgrade-first-controlplane.yaml"

- name: Reboot machine
  # when: kube_upgrade_needed or crio_upgrade_needed or reboot_required_file.stat.exists
  ansible.builtin.include_tasks: "{{ playbook_dir }}/roles/utils/tasks/reboot-machine.yaml"

- name: Uncordon node
  # when: auto_upgrades and kube_upgrade_needed
  ansible.builtin.include_tasks: "{{ playbook_dir }}/roles/utils/tasks/uncordon-node.yaml"

- name: Generate join secrets
  ansible.builtin.include_tasks: "generate-join-secrets.yaml"

- name: Add Helm apt packages
  ansible.builtin.include_tasks: "add-helm-apt-resources.yaml"
