---
- name: Get kubeadm join token
  ansible.builtin.shell: |
    sudo kubeadm token create --print-join-command
  changed_when: false
  register: join_command

- name: Set variables for join-cp.yaml template
  ansible.builtin.set_fact:
    local_ip_address: "{{ ansible_all_ipv4_addresses | ansible.utils.ipaddr(local_ip_address_range) }}"

- name: Generate join-cp.yaml file
  ansible.builtin.template:
    src: ./templates/join-cp.yaml.j2
    dest: /tmp/join-cp.yaml
    mode: '0700'
