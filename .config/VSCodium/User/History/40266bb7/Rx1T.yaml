apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

commonLabels:
  env: pre-stage

resources:
  - ../../../base
  - ./empfangsclient-ecc-secrets.yaml
  - ./empfangsclient-ecc-configmap.yaml
  - ./empfangsclient-ecc-version-ingress.yaml
  - ./empfangsclient-ecc-service-account.yaml
  - ./empfangsclient-ecc-role.yaml
  - ./empfangsclient-ecc-role-binding.yaml
  # - ./empfangsclient-ecc-servicemonitor.yaml
  - ./empfangsclient-ecc-hpa.yaml
  - ./empfangsclient-eco-configmap.yaml
  - ./empfangsclient-eco-version-ingress.yaml
  - ./empfangsclient-eco-service-account.yaml
  - ./empfangsclient-eco-role.yaml
  - ./empfangsclient-eco-role-binding.yaml
  # - ./empfangsclient-eco-servicemonitor.yaml

images:
  - name: DOCKER_IMAGE_ECC
    newName: habor.owl-it.de/efa/ecc
    newTag: v2.4.0
  - name: DOCKER_IMAGE_ECO
    newName: habor.owl-it.de/efa/eco
    newTag: v3.6.0
  - name: DOCKER_IMAGE_SIDECAR
    newName: habor.owl-it.de/efa/version-sidecar
    newTag: v1.3.2

patches:
  - path: empfangsclient-ecc.patch.yaml
    target:
      kind: Deployment
      name: empfangsclient-ecc
  - path: empfangsclient-eco-ingress.patch.yaml
    target:
      kind: Ingress
      name: empfangsclient-eco-ingress
  - path: empfangsclient-eco.patch.yaml
    target:
      kind: Deployment
      name: empfangsclient-eco
  - path: empfangsclient-eco-ingress-rate-limited.patch.yaml
    target:
      kind: Ingress
      name: empfangsclient-eco-ingress-rate-limited

secretGenerator:
  - name: mariadb-auth-ecc
    envs:
    - ./mixins/mariadb-auth-ecc.secret.env
    options:
      disableNameSuffixHash: true
  - name: mariadb-auth-eco
    envs:
    - ./mixins/mariadb-auth-eco.secret.env
    options:
      disableNameSuffixHash: true
