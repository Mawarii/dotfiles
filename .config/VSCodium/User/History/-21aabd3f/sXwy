# Use the provided Tomcat image as the base image
FROM code.europa.eu:4567/edelivery/docker/domibus-tomcat9:5.1.3

# edelivery is already a non-root user whose uid and gid = 1000

# Set environment variables
ENV domibus.metrics.sl4j.reporter.enable=false
ENV domibus.metrics.monitor.jms.queues=false
ENV domibus.metrics.monitor.memory=false
ENV domibus.metrics.monitor.gc=false
ENV domibus.metrics.monitor.cached.threads=false
ENV domibus.passwordPolicy.expiration=0
ENV domibus.passwordPolicy.defaultPasswordExpiration=0
# ...

# Add further steps if needed e.g. COPY domibus, RUN chown, etc
RUN sed -i '$d' /data/domInstall/scripts/entrypoint.sh
# Start Tomcat
ENTRYPOINT ['"${CATALINA_HOME}"/bin/catalina.sh run -DCATALINA_OPTS="${CATALINA_OPTS}" 2>&1 | tee "${CATALINA_HOME}"/logs/catalina.out']
