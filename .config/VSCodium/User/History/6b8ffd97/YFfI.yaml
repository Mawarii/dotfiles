---
Domain: forms-flow-api.digital-vm-services.bwl.de   #<DEFINE_ME>

postgresql:
  host: forms-flow-postgresql-ai
  port: 5432

  database: formsflowapi
  username: formsflow

  externalSecret:
    name: forms-flow-postgresql-ai
    usernameKey: ""
    passwordKey: password

initContainers:
  - name: forms-flow-bpm-checker
    # image: busybox
    image: registry.os.bwl.de/hub.docker.com/busybox:latest
    command:
    - '/bin/sh'
    - '-c'
    - |
      echo "Waiting for BPM-Container to be ready..."  
      while true; do         
        echo "Check running..."
        sleep 1
        if wget --spider --quiet "http://forms-flow-bpm:8080/camunda/actuator/health"; then
          echo "-> BPM-Container is ready - completing initContainer."
          break
        else
          echo "-> BPM-Container not ready (next run in 10s...)";
          sleep 9
        fi
      done
      echo "Starting api-Container."
    resources:
      limits:
        cpu: 600m
        memory: 768Mi
      requests:
        cpu: 500m
        memory: 512Mi

resources:
  limits:
    cpu: 600m
    memory: 768Mi
  requests:
    cpu: 500m
    memory: 512Mi

formsflow:
  configmap: forms-flow-ai # name of formsflow.ai configmap
  secret: forms-flow-ai #name of formsflow.ai secret
  analytics: forms-flow-analytics #name of forms-flow-analytics component
  auth: publicplan-harbor-registry # imagePullSecret (manual secret can be named here)

ingress:
  ingressClassName: nginx
  annotations: {}
  enabled: true # create an ingress for this component
  hostname: "forms-flow-api.digital-vm-services.bwl.de"
  port: 5000
  tls: false
  selfSigned: false
  extraTls:
    - {}

image:
  # registry: registry.os.bwl.de/hub.docker.com ## dockerhub via BITBW because of Ratelimit if docker.io is used directly
  # repository: formsflow/forms-flow-webapi
  # tag: v5.3.1 ## The image tag to pull from
  registry: registry.os.bwl.de ## registry Gitlab pp (not working due to name resolution)
  repository: harbor.internal.publicplan.cloud/lowcode/digv/api
  tag: dv-1.11.0

extraVolumes:
  - name: "forms-flow-migration-script"
    configMap:
      name: "forms-flow-migration-script"
extraVolumeMounts:
  - name: "forms-flow-migration-script"
    mountPath: "/forms-flow-api/app/migration-script/"
    readOnly: true
