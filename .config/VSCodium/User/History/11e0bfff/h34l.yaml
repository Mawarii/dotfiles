---
- name: Add firewall rule for default SSH port
  hetzner.hcloud.firewall:
    api_token: "{{ hcloud_token }}"
    name: "default_ssh_port"
    rules:
      - port: "{{ default_ssh_port }}"
        protocol: tcp
        direction: in
        source_ips:
          - 0.0.0.0/0
          - ::/0
    state: present

- name: Apply default SSH port firewall to all cluster machines
  hetzner.hcloud.firewall_resource:
    api_token: "{{ hcloud_token }}"
    firewall: "default_ssh_port"
    label_selectors:
      - vm-type=controlplane
      - vm-type=worker
    state: present
