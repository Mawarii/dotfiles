apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources: []
#   - ../../base
#   - ../../../../databases/bitnami-mariadb-10.11.4-debian-11-r0/overlays/staging
#   - matomo-version-ingress.yaml

# patches:
#   - path: matomo.patch.yaml
#     target:
#       kind: Deployment
#       name: matomo
#   - path: matomo-ingress.patch.yaml
#     target:
#       kind: Ingress
#       name: matomo-ingress
#   - path: matomo-archive-cronjob.patch.yaml
#     target:
#       kind: CronJob
#       name: matomo-archive-job
#   - path: mariadb-secret.patch.yaml
#     target:
#       kind: Secret
#       name: mariadb-wsp-secret
#   - path: mariadb-configmap.patch.yaml
#     target:
#       kind: ConfigMap
#       name: mariadb

# images:
#   - name: DOCKER_IMAGE_1
#     newName: gitlab.krz.de:4567/customers/publicplan/wsp/staging/images/nginx-hardened
#     newTag: v0.0.1
#   - name: DOCKER_IMAGE_1_ORIGIN
#     newName: gitlab.publicplan.cloud:5050/themenwelt-wirtschaft/infrastruktur/common/base-images/nginx-hardened
#     newTag: v0.0.1
#   - name: DOCKER_IMAGE_2
#     newName: gitlab.krz.de:4567/customers/publicplan/wsp/staging/images/matomo
#     newTag: fpm-alpine
#   - name: DOCKER_IMAGE_2_ORIGIN
#     newName: gitlab.publicplan.cloud:5050/themenwelt-wirtschaft/infrastruktur/common/app-configs/matomo
#     newTag: fpm-alpine
#   - name: DOCKER_IMAGE_3
#     newName: gitlab.krz.de:4567/customers/publicplan/wsp/staging/images/version-sidecar
#     newTag: v1.3.1
#   - name: DOCKER_IMAGE_3_ORIGIN
#     newName: gitlab.publicplan.cloud:5050/themenwelt-wirtschaft/infrastruktur/tools/version-sidecar
#     newTag: v1.3.1
#   - name: DOCKER_IMAGE_4
#     newName: gitlab.krz.de:4567/customers/publicplan/wsp/staging/images/backup-jobs
#     newTag: v1.2.3
#   - name: DOCKER_IMAGE_4_ORIGIN
#     newName: gitlab.publicplan.cloud:5050/themenwelt-wirtschaft/infrastruktur/tools/backup-jobs
#     newTag: v1.2.3

# replacements: #version sidecar replacements
#   - source:
#       kind: Deployment
#       name: matomo
#       fieldPath: spec.template.spec.containers.[name=matomo-nginx].image
#     targets:
#     - select:
#         kind: Deployment
#         name: matomo
#       fieldPaths:
#         - spec.template.spec.containers.[name=version-sidecar].env.[name=DOCKER_IMAGE_1].value
#       options:
#         create: true
#   - source:
#       kind: Deployment
#       name: matomo
#       fieldPath: spec.template.spec.containers.[name=matomo].image
#     targets:
#     - select:
#         kind: Deployment
#         name: matomo
#       fieldPaths:
#         - spec.template.spec.containers.[name=version-sidecar].env.[name=DOCKER_IMAGE_2].value
#       options:
#         create: true
#   - source:
#       kind: Deployment
#       name: matomo
#       fieldPath: spec.template.spec.containers.[name=version-sidecar].image
#     targets:
#     - select:
#         kind: Deployment
#         name: matomo
#       fieldPaths:
#         - spec.template.spec.containers.[name=version-sidecar].env.[name=DOCKER_IMAGE_3].value
#       options:
#         create: true
#   - source:
#       kind: StatefulSet
#       name: mariadb
#       fieldPath: spec.template.spec.containers.[name=mariadb].image
#     targets:
#     - select:
#         kind: Deployment
#         name: matomo
#       fieldPaths:
#         - spec.template.spec.containers.[name=version-sidecar].env.[name=DATABASE_DOCKER_IMAGE_3].value
#       options:
#         create: true
