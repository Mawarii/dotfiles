---
- name: Add Helm apt repository
  block:
    - name: Download Helm signing key
      ansible.builtin.apt_key:
        url: https://baltocdn.com/helm/signing.asc
        keyring: /usr/share/keyrings/helm-key.gpg
        state: present

    - name: Add Helm sources
      ansible.builtin.apt_repository:
        repo: "deb [signed-by=/usr/share/keyrings/helm-key.gpg] https://baltocdn.com/helm/stable/debian/ all main"
        state: present
        filename: "helm-stable"

- name: Install Helm package
  ansible.builtin.apt:
    pkg:
      - helm
      - git
    state: present
    update_cache: true

- name: Install Helm diff plugin
  kubernetes.core.helm_plugin:
    plugin_path: https://github.com/databus23/helm-diff
    state: present
