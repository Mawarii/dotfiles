apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: etr
  name: etr
spec:
  replicas: 1
  selector:
    matchLabels:
      app: etr
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: etr
    spec:
      imagePullSecrets:
        - name: gitlab-registry
      containers:
        - image: DOCKER_IMAGE_1
          name: etr
          resources:
            requests:
              cpu: "1"
              memory: "1Gi"
            limits:
              cpu: "1"
              memory: "1Gi"
          volumeMounts:
            - mountPath: /home/etr
              name: etr-data-dir
            - mountPath: /opt/ELSTER-Transfer/etr/config
              name: etr-config-dir
            - mountPath: /opt/ELSTER-Transfer/etr/config/application.yml
              name: application-yaml
              subPath: application.yml
              readOnly: true
            - mountPath: /opt/ELSTER-Transfer/etr/config/auth.yml
              name: application-yaml
              subPath: auth.yml
              readOnly: true
            - mountPath: /usr/local/bin/scripts
              name: helpers
              readOnly: true
      volumes:
        - name: etr-config-dir
          emptyDir: {}
        - name: etr-data-dir
          persistentVolumeClaim:
            claimName: etr-data-dir
        - name: application-yaml
          configMap:
            name: application-yaml
        - name: helpers
          configMap:
            name: helpers
