livenessProbe:
  initialDelaySeconds: 60
  periodSeconds: 10
  successThreshold: 1
  failureThreshold: 3
  terminationGracePeriodSeconds: 30

readinessProbe:
  initialDelaySeconds: 60
  periodSeconds: 10
  successThreshold: 1
  failureThreshold: 3

concurrent: 20

gitlabUrl: https://gitlab.publicplan.cloud
unregisterRunners: true

rbac:
  create: true
  rules:
    - resources: ["events"]
      verbs: ["list", "watch"]
    - resources: ["namespaces"]
      verbs: ["create", "delete"]
    - resources: ["pods"]
      verbs: ["create", "delete", "get"]
    - apiGroups: [""]
      resources: ["pods/attach", "pods/exec"]
      verbs: ["get", "create", "patch", "delete"]
    - apiGroups: [""]
      resources: ["pods/log"]
      verbs: ["get", "list"]
    - resources: ["secrets"]
      verbs: ["create", "delete", "get", "update"]
    - resources: ["serviceaccounts"]
      verbs: ["get"]
    - resources: ["services"]
      verbs: ["create", "get"]

serviceAccount:
  create: true

runnerToken: "glrt-U8ghXQaWyyPvMn_XsniF"

runners:
  config: |
    [[runners]]
      [runners.kubernetes]
        namespace = "{{.Release.Namespace}}"
        image = "ubuntu:22.04"
        privileged = true
        image_pull_secrets = ["cloud-docker-com"]
        cpu_request = "1000m"
        service_cpu_request = "1000m"
        helper_cpu_request = "500m"
        memory_request = "1Gi"
        helper_memory_request = "500Mi"
        service_memory_request = "1Gi"
        ephemeral_storage_request = "5Gi"
        helper_ephemeral_storage_request = "1Gi"
        service_ephemeral_storage_request = "5Gi"
        poll_timeout = 3600
        [runners.cache]
          Type = "s3"
          Path = "runner"
          Shared = true
          [runners.cache.s3]
            ServerAddress = "172.16.30.12:9000"
            BucketName = "gitlab-runner"
            BucketLocation = "eu-west-1"
            Insecure = true
            AuthenticationType = "access-key"
            AccessKey = "cU6IUfo14a26s7uA3thQ8fAl4n4V4t5T"
            SecretKey = "JcWxId34d6CoAtduBCl85lKpQ8isqp9xg6A6pD6r8A17SPA1e6Z3sT8DoU3gEi2hHq4l8Vb5dIzsL2WcfG3ME7Q5D3Y1Vy4Qi3Kj2KrA3g79U2V83wKVrAg9A1i3X85o"
      [runners.kubernetes.pod_annotations]
        "descheduler.alpha.kubernetes.io/evict" = "true"
        "velero.io/exclude-from-backup" = "true"
      [[runners.kubernetes.volumes.empty_dir]]
        name = "docker-certs"
        mount_path = "/certs/client"
        medium = "Memory"
      [[runners.kubernetes.volumes.config_map]]
        name = "gitlab-docker-daemon-json"
        mount_path = "/etc/docker/daemon.json"
        sub_path = "daemon.json"
        read_only = true 
        [runners.kubernetes.volumes.config_map.items]
          "daemon.json" = "daemon.json"

resources:
  limits:
    memory: 2Gi
    cpu: "2"
  requests:
    memory: 2Gi
    cpu: "2"
