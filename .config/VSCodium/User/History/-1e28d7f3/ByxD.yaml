apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-configuration
data:
  grafana.ini: |-
    #################################### Server ####################################
    [server]
    domain = ${GRAFANA_DOMAIN}
    root_url = ${GRAFANA_DOMAIN}

    #################################### Generic OAuth ##########################
    [auth.generic_oauth]
    enabled = true
    name = Keycloak
    allow_sign_up = true
    client_id = grafana-wsp
    client_secret = K1lukk599gGZqpJfkXnJCY2Jr6PWSKOb
    scopes = openid email profile offline_access roles
    email_attribute_path = email
    login_attribute_path = username
    name_attribute_path = full_name
    auth_url = https://keycloak.live.publicplan.cloud/auth/realms/master/protocol/openid-connect/auth
    token_url = https://keycloak.live.publicplan.cloud/auth/realms/master/protocol/openid-connect/token
    api_url = https://keycloak.live.publicplan.cloud/auth/realms/master/protocol/openid-connect/userinfo
    role_attribute_path: contains(groups[*], 'monitoring-admin') && 'Admin' || contains(resource_access."grafana-wsp".roles[*], 'editor') && 'Editor' || 'Viewer'
    allow_assign_grafana_admin = true

    [log]
    level=debug
  