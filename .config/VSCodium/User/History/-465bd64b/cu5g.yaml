apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base
  - ../../database/bitnami-mysql-8.0.33-debian-11-r28/overlays/develop
  - elasticsearch.yaml

patches:
  - path: govforms2-akeneo.patch.yaml
    target:
      kind: Deployment
      name: govforms2-akeneo
  - path: govforms2-akeneo-ingress.patch.yaml
    target:
      kind: Ingress
      name: govforms2-akeneo-ingress
  - path: govforms2-akeneo-secrets.patch.yaml
    target:
      kind: Secret
      name: govforms2-akeneo-secrets
  - path: govforms2-mysql.patch.yaml
    target:
      kind: StatefulSet
      name: mysql-wsp
  - path: mysql-secret.patch.yaml
    target:
      kind: Secret
      name: mysql-wsp

secretGenerator:
- envs:
  - secrets/tww-read-registry-token.env
  name: tww-wirtschaft-pull-token
  type: kubernetes.io/dockerconfigjson
- envs:
  - secrets/twf-read-registry-token.env
  name: twf-wirtschaft-pull-token
  type: kubernetes.io/dockerconfigjson

images:
  - name: DOCKER_IMAGE_1
    newName: gitlab.publicplan.cloud:5050/themenwelt-formulare/govforms2/form-config/akeneo
    newTag: "v0.2.2"
  - name: DOCKER_IMAGE_2
    newName: gitlab.publicplan.cloud:5050/themenwelt-wirtschaft/infrastruktur/common/base-images/nginx-hardened
    newTag: "v0.0.1"
  - name: DOCKER_IMAGE_3
    newName: gitlab.publicplan.cloud:5050/themenwelt-formulare/govforms2/form-config/formio-akeneo-sync
    newTag: "v0.3.2"
