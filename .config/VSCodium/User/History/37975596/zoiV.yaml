- name: Bootstrap first controlplane
  hosts: controlplanes[0]
  become: true
  gather_facts: true
  roles:
    - role: bootstrap-cluster
      custom_action: first-controlplane
    - role: bootstrap-cluster
      custom_action: generate-join-variables
    - role: common
      custom_action: install-helm-apt-packages
    - role: install-cni
      custom_action: install-cilium
    - role: install-storage
      custom_action: install-hcloud-csi

- name: Join new controlplane
  hosts: controlplanes[1:]
  become: true
  gather_facts: true
  roles:
    - role: bootstrap-cluster
      custom_action: join-node

- name: Join new worker
  hosts: worker
  become: true
  gather_facts: true
  roles:
    - role: bootstrap-cluster
      custom_action: join-node
